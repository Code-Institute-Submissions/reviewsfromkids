{% extends "base.html" %}
{% load static %}

{% block page_header %}
{% endblock %}

{% block hero %} 
{% endblock %}

{% block content %}
  <main>
    
    <div class="book-details">
      <h2 class="book-details__title">{{ book.title }}</h2>      
      <div class="book-details__image-container">
        <img class="card-img-top img-fluid" src="{{ book.image_detail.url }}" alt="{{ book.name }}">
      </div>

      <ul class="nav book-details__pills scrolling-wrapper-flexbox">
        
            <li><a class="active" data-toggle="pill" href="#menu1">For you?</a></li>
            <li><a data-toggle="pill" href="#menu2">Description</a></li>
            <li><a data-toggle="pill" href="#menu3">Quick facts</a></li>
            <li><a data-toggle="pill" href="#menu4">Your rating</a></li>
            <li><a data-toggle="pill" href="#menu5">Info</a></li>
   
      </ul>
      
      <div class="container">

        <div class="tab-content">

          <div id="menu1" class="tab-pane fade in show active">
            <div class="book-details__section">
              <h4>Is this book for you?</h4>
              <div class="rating-static-table">
                <div class="rating-static-table__rating-1">
                  <div class="rating-static">
                    <input type="radio" id="star-static5" name="rating-static" value="5" {% if book.star_rating_all == 5 %}checked{% endif %}/><label class = "full" for="star-static5"></label>
                    <input type="radio" id="star-static4half" name="rating-static" value="4 and a half" {% if book.star_rating_all == 4.5 %}checked{% endif %}/><label class="half" for="star-static4half"></label>
                    <input type="radio" id="star-static4" name="rating-static" value="4" {% if book.star_rating_all == 4 %}checked{% endif %}/><label class = "full" for="star-static4"></label>
                    <input type="radio" id="star-static3half" name="rating-static" value="3 and a half" {% if book.star_rating_all == 3.5 %}checked{% endif %}/><label class="half" for="star-static3half"></label>
                    <input type="radio" id="star-static3" name="rating-static" value="3" {% if book.star_rating_all == 3 %}checked{% endif %}/><label class = "full" for="star-static3"></label>
                    <input type="radio" id="star-static2half" name="rating-static" value="2 and a half" {% if book.star_rating_all == 2.5 %}checked{% endif %}/><label class="half" for="star-static2half"></label>
                    <input type="radio" id="star-static2" name="rating-static" value="2" {% if book.star_rating_all == 2 %}checked{% endif %}/><label class = "full" for="star-static2"></label>
                    <input type="radio" id="star-static1half" name="rating-static" value="1 and a half" {% if book.star_rating_all == 1.5 %}checked{% endif %}/><label class="half" for="star-static1half"></label>
                    <input type="radio" id="star-static1" name="rating-static" value="1" {% if book.star_rating_all == 1 %}checked{% endif %}/><label class = "full" for="star-static1"></label>
                    <input type="radio" id="star-statichalf" name="rating-static" value="half" {% if book.star_rating_all == 0.5 %}checked{% endif %}/><label class="half" for="star-statichalf"></label>
                  </div>
                </div>
                <div class="rating-static-table__rating-2">({{ book.number_of_ratings }} ratings)</div>
              </div>
              <p>54 kids say they want to read this book.</p>
              
                              
              <div class="accordion" id="accordionExample">

                <div class="card">

                  <div class="card-header" id="headingOne">
                    <h4 class="mb-0">
                      <div class="btn-block text-left" type="button" data-toggle="collapse" data-target="#kidsLike" aria-expanded="true" aria-controls="collapseOne">
                        Kids who <span class="emphasis1">like</span> this book
                      </div>
                    </h4>
                  </div>
                  <div id="kidsLike" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                    <div class="card-body">
                      {% if avg_age_positive_ratings == None and not hobbies_positive_ratings and not sports_positive_ratings %}
                        <p>No information available yet.</p>
                      {% else %}
                        {% if avg_age_positive_ratings == None %}
                        {% else %}
                          Have an average age of {{ avg_age_positive_ratings }}
                        {% endif %}
  
                        {% if hobbies_positive_ratings %}
                          Have these hobbies:
                            {% for i in hobbies_positive_ratings %}
                              {{ i.name }} ({{ i.name__count }} kids)
                            {% endfor %}
                        {% else %}
                        {% endif %}
  
                        {% if sports_positive_ratings %}
                          Do these sports:
                            {% for i in sports_positive_ratings %}
                              {{ i.name }} ({{ i.name__count }} kids)
                            {% endfor %}
                        {% else %}
                        {% endif %}
                      {% endif %}
                    </div> 
                  </div>

                  <div class="card-header" id="headingTwo">
                    <h4 class="mb-0">
                      <div class="btn-block text-left" type="button" data-toggle="collapse" data-target="#kidsDislike" aria-expanded="true" aria-controls="collapseOne">
                        Kids who <span class="emphasis1">don't like</span> this book
                      </div>
                    </h4>
                  </div>
                  <div id="kidsDislike" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                    <div class="card-body">
                      <!-- Age, hobbies and sports of negative ratings -->       
                      {% if avg_age_negative_ratings == None and not hobbies_negative_ratings and not sports_negative_ratings %}
                        No negative opinions! This must be a good book :)
                      {% else %}
                        {% if avg_age_negative_ratings == None %}
                        {% else %}
                          Have an age of {{ avg_age_negative_ratings }}
                        {% endif %}
                      
                        {% if hobbies_negative_ratings %}
                          Have these hobbies:
                          {% for i in hobbies_negative_ratings %}
                            {{ i.name }} ({{ i.name__count }} kids)
                          {% endfor %}
                        {% else %}
                        {% endif %}
                      
                        {% if sports_negative_ratings %}
                          Do these sports:
                          {% for i in sports_negative_ratings %}
                            {{ i.name }} ({{ i.name__count }} kids)
                          {% endfor %}
                        {% else %}
                        {% endif %}
                      {% endif %}
                      
                    </div> 
                  </div>

                  <div class="card-header" id="headingThree">
                    <h4 class="mb-0">
                      <div class="btn-block text-left" type="button" data-toggle="collapse" data-target="#onYourList" aria-expanded="true" aria-controls="collapseOne">
                        {% if favorite %}This book is on <span class="emphasis1">your</span> list{% else %}Do <span class="emphasis1">you</span> want to read this book?{% endif %}
                      </div>
                    </h4>
                  </div>
                  <div id="onYourList" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                    <div class="card-body book-details__favorites">
                      <!-- Add to favorites-->
                    {% if favorite %}
                      <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" value="remove_fav" name="type_of_action">
                        <button class="iconify" value="submit"><i class="book-details__icon--fav fas fa-heart fa-3x" aria-hidden="true"></i></button>
                      </form>
                      <p>You have this book on your 'want to read list'</p>
                    {% else %}
                      {% if user_logged_in %}
                        <form method="POST">
                          {% csrf_token %}
                          <input type="hidden" value="add_fav" name="type_of_action">
                          <button class="iconify" value="submit"><i class="book-details__icon--not-fav fas fa-heart fa-3x" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Tooltip on top"></i></button>
                        </form>
                        <p>Do you want to read this book (someday)? Add it to your list!</p>
                      {% else %}
                        <i class="book-details__icon--not-fav fas fa-heart fa-3x" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Tooltip on top"></i>
                        <p>Please log in to add to your list.</p>
                      {% endif %}
                    {% endif %}
                    </div> 
                  </div>

                </div>

              </div>
            </div>
          </div>

          <div id="menu2" class="tab-pane fade">
            <div class="book-details__section">
              <h4>This book is about</h4>
              <p>
                {{ book.description }}
              </p>                
              <div class="book-details__section__category">
                <p>Category:</p>
                <div class="book-details__section__category--col">
                  <form class="book-details__section__category--col--item" method="GET" action="{% url 'books' %}">
                    <input type="hidden" value="cat-search" name="type_of_action"/>
                    <input type="hidden" value="{{ book.category.id }}" name="category"/>
                    <button class="tag tag--category tag--category--link">{{ book.category }}</button>
                  </form>
                </div>
              </div>
              <div class="book-details__section__tags">
              <p>Tags:</p>
                <div class="book-details__section__tags--col">
                  {% for tag in book.tags.all %}
                  <form class="book-details__section__tags--col--item" method="GET" action="{% url 'books' %}">
                    <input type="hidden" value="tag-search" name="type_of_action"/>
                    <input type="hidden" value="{{ tag }}" name="tags"/>
                    <button class="tag tag--tag tag--tag--link">{{ tag }}</button>
                  </form>
                  {% endfor %}
                </div>
              </div>
            </div>  
          </div>
            
          <div id="menu3" class="tab-pane fade">
            <div class="book-details__quick-facts">
              <div class="book-details__quick-facts__age">
                <small>Recommended age:</small> <br>{{ book.recommended_age }} yrs
              </div>
              <div class="book-details__quick-facts__ratings">
                Rating all: <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ book.rating }} / 5 ({{ book.number_of_ratings }})</small>
                Rating girls: <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ book.girls_avg_rating }} / 5 ({{ book.girls_number_of_ratings }})</small>
                Rating boys: <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ book.boys_avg_rating }} / 5 ({{ book.boys_number_of_ratings }})</small>
              </div>
            </div>
          </div>

          <div id="menu4" class="tab-pane fade">
            <div class="book-details__section">
              <h4>Your rating</h4>
              <p>Did you read this book? Great! Or not great... that depends. Did you like to read it? Please help others and tell them what you think.</p>
              {% if user_logged_in and allowed_to_rate %}
                {% if not already_rated %}
                <form method="POST" action="{% url 'book_detail' book.id %}">
                  {% csrf_token %}
                  <fieldset class="rating">
                    <input type="radio" id="star5" name="ratingOptions" value="5" /><label class="full" for="star5"></label>
                    <input type="radio" id="star4" name="ratingOptions" value="4" /><label class="full" for="star4"></label>
                    <input type="radio" id="star3" name="ratingOptions" value="3" /><label class="full" for="star3"></label>
                    <input type="radio" id="star2" name="ratingOptions" value="2" /><label class="full" for="star2"></label>
                    <input type="radio" id="star1" name="ratingOptions" value="1" /><label class="full" for="star1"></label>
                  </fieldset>
                  <input type="hidden" value="new" name="type_of_action">
                  <input class="text" name="rated_by" value="{{ request.user }}" hidden>
                  <input class="text" name="book_id" value="{{ book.pk }}" hidden>
                  <button type="submit">rate</button>
                </form>
                {% else %}
                Your rating:
                <form method="POST" action="{% url 'book_detail' book.id %}">
                  {% csrf_token %}
                  <fieldset class="rating">
                    <input type="radio" id="star5" name="ratingOptions" value="5" {% if current_user_rating.rating == 5 %}checked{% endif %}/><label class="full" for="star5"></label>
                    <input type="radio" id="star4" name="ratingOptions" value="4" {% if current_user_rating.rating == 4 %}checked{% endif %}/><label class="full" for="star4"></label>
                    <input type="radio" id="star3" name="ratingOptions" value="3" {% if current_user_rating.rating == 3 %}checked{% endif %}/><label class="full" for="star3"></label>
                    <input type="radio" id="star2" name="ratingOptions" value="2" {% if current_user_rating.rating == 2 %}checked{% endif %}/><label class="full" for="star2"></label>
                    <input type="radio" id="star1" name="ratingOptions" value="1" {% if current_user_rating.rating == 1 %}checked{% endif %}/><label class="full" for="star1"></label>
                  </fieldset>
                  <input type="hidden" value="edit" name="type_of_action">
                  <input class="text" name="rated_by" value="{{ request.user }}" hidden>
                  <input class="text" name="book_id" value="{{ book.pk }}" hidden>
                  <button type="submit">update</button>
                </form>
                <form method="POST" action="{% url 'book_detail' book.id %}">
                  {% csrf_token %}
                  <input type="hidden" value="delete" name="type_of_action">                    
                  <button type="submit">delete</button>
                </form> 
                {% endif %}
              {% elif user_logged_in and not allowed_to_rate %}
                <p>We love your rating. To make your rating even better, we'd like to know a bit more about you. So, other kids can see if your rating is helpful for them. Please complete your profile first: <a href="{% url 'profile' %}">my profile</a>.</p>
              {% else %}
                <p>We love your rating. Please <a href="{% url 'account_login' %}">log in</a>. No account? You can get one -completely free- over <a href="{% url 'account_signup' %}">here</a>!</p>
              {% endif %}
            </div>
          </div>
            
          <div id="menu5" class="tab-pane fade">
            <div class="book-details__section">
              <h4>Book info</h4>
              <p class="mt-3">ISBN: {{ book.isbn }}</p>
              <p class="mt-3">Pages: {{ book.pages }}</p>
              <p class="mt-3">Age from {{ book.age }}</p>
              <p class="mt-3">Best suited for {% if book.gender == "all" %} girls and boys.                  
                {% else %}
                {{ book.gender }} {% endif %}</p>
              <p class="mt-3">Author: {{ book.author }}</p>
            </div>
          </div>

        </div>

      </div>
    </div>
    
  </main>
{% endblock %}
{% block postloadjs %}
<!-- <script>
  $('#kidsLike').collapse({
    toggle: true
  })
</script> -->

{% endblock %}