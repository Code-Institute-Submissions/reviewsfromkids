{% extends "base.html" %}
{% load static %}

{% block page_header %}
{% endblock %}

{% block hero %} 
{% endblock %}

{% block content %}
  <main>
    </div>
    <div class="book-details">
      <h2 class="book-details__title">{{ book.title }}</h2>      
      <div class="book-details__image-container">
        <img class="card-img-top img-fluid" src="{{ book.image.url }}" alt="{{ book.name }}">
      </div>
      <div> 
        
      <ul class="nav book-details__pills scrolling-wrapper-flexbox">
        
            <li><a class="active" data-toggle="pill" href="#menu1">Description</a></li>
            <li><a data-toggle="pill" href="#menu4">For you?</a></li>
            <li><a data-toggle="pill" href="#menu2">Quick facts</a></li>
            <li><a data-toggle="pill" href="#menu3">Ratings</a></li>
            <li><a data-toggle="pill" href="#menu10">Info</a></li>
   
      </ul>
      
      <div class="container">
        <div class="tab-content">
            <div id="menu1" class="tab-pane fade in show active">
              <div class="book-details__section">
                <h4>This book is about</h4>
                <p>
                  {{ book.description }}
                </p>                
                <div class="book-details__section__category">
                Category: <span class="badge badge-primary">{{ book.category }}</span>
                </div>
                <div class="book-details__section__tags">
                Tags:  {% for tag in book.tags.all %}
                    <span class="badge badge-info">{{ tag }}</span>
                  {% endfor %}
                </div>
              </div>  
            </div>
            <div id="menu4" class="tab-pane fade">
              <div class="book-details__section">
                <h4>Is this book for you?</h4>
                Check variables:
                <ul>
                <li>'not_recommended_by_age_girls': {{ not_recommended_by_age_girls }},</li>
                <li>'recommended_age_girls': {{ recommended_age_girls }},</li>
                <li>'not_recommended_by_age_boys': {{ not_recommended_by_age_boys }},</li>
                <li>'recommended_age_boys': {{ recommended_age_boys}} ,</li>
                <li>'most_disliked_by': {{ book.most_disliked_by }},</li>
                <li>'most_liked_by': {{ book.most_liked_by }},</li>
                  </ul>


                {% if no_ratings_info_at_all == True %}
                  Kids have not completed their profile or nobody has rated this book yet. Did you read this book? Let others know if you like it or not! <a  data-toggle="pill" href="#menu3" class=btn>rate it</a>
                {% else %}
                  <p>Let's help you to find out. Below you see what other kids who rated this book like.</p>

                  <!-- Age, hobbies and sports of positive ratings -->
                  <h5>Kids who <span class="emphasis1">like</span> this book</h5>
                  {% if avg_age_positive_ratings == None and not hobbies_positive_ratings and not sports_positive_ratings %}
                    No information available yet.
                  {% else %}
                    {% if avg_age_positive_ratings == None %}
                    {% else %}
                      Have an average age of {{ avg_age_positive_ratings }}
                    {% endif %}
                    {% if hobbies_positive_ratings %}
                    Have these hobbies:
                      {% for i in hobbies_positive_ratings %}
                        {{ i.name }} ({{ i.name__count }} kids)
                      {% endfor %}
                    {% else %}
                    {% endif %}
                    {% if sports_positive_ratings %}
                      Do these sports:
                      {% for i in sports_positive_ratings %}
                        {{ i.name }} ({{ i.name__count }} kids)
                      {% endfor %}
                    {% else %}
                    {% endif %}
                  {% endif %}
                  
                  <!-- Age, hobbies and sports of negative ratings -->
                  <h5>Kids who <span class="emphasis1">don't like</span> this book</h5>
                  {% if avg_age_negative_ratings == None and not hobbies_negative_ratings and not sports_negative_ratings %}
                    No information available yet. This must be a good book :)
                  {% else %}
                    {% if avg_age_negative_ratings == None %}
                    {% else %}
                      Have an age of {{ avg_age_negative_ratings }}
                    {% endif %}
                    {% if hobbies_negative_ratings %}
                    Have these hobbies:
                      {% for i in hobbies_negative_ratings %}
                        {{ i.name }} ({{ i.name__count }} kids)
                      {% endfor %}
                    {% else %}
                    {% endif %}
                    {% if sports_negative_ratings %}
                      Do these sports:
                      {% for i in sports_negative_ratings %}
                        {{ i.name }} ({{ i.name__count }} kids)
                      {% endfor %}
                    {% else %}
                    {% endif %}
                  {% endif %}
                {% endif %}
                <!-- Add to favorites-->
                {% if favorite %}
                  <h4>This book is in your favorites. You want to read it!</h4>
                  <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" value="remove_fav" name="type_of_action">
                    <button class="iconify" value="submit"><i class="book-details__title-bar-icon fa fa-heart" aria-hidden="true"></i></button>
                  </form>
                {% else %}  
                  <h4>Add to your want to read list</h4>
                  {% if user_logged_in %}
                    <form method="POST">
                      {% csrf_token %}
                      <input type="hidden" value="add_fav" name="type_of_action">
                      <button class="iconify" value="submit"><i class="book-details__title-bar-icon far fa-heart" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Tooltip on top"></i></button>
                    </form>
                  {% else %}
                    Please log in to add to your list.
                  {% endif %}
                {% endif %}
                <div class="book-details__title-bar">
            
                </div>
              </div>
            </div>
            <div id="menu2" class="tab-pane fade">
              <div class="book-details__quick-facts">
                <div class="book-details__quick-facts__age">
                  <small>Recommended age:</small> <br>{{ book.recommended_age }} yrs
                </div>
                <div class="book-details__quick-facts__ratings">
                  Rating all: <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ book.rating }} / 5 ({{ book.number_of_ratings }})</small>
                  Rating girls: <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ book.girls_avg_rating }} / 5 ({{ book.girls_number_of_ratings }})</small>
                  Rating boys: <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ book.boys_avg_rating }} / 5 ({{ book.boys_number_of_ratings }})</small>
                </div>
              </div>
            </div>
            <div id="menu3" class="tab-pane fade">
              <div class="book-details__section">
                <h4>Reviews & Ratings</h4>
                {% if user_logged_in %}
                  {% if not already_rated %}
                  Rate this book
                  <form method="POST" action="{% url 'book_detail' book.id %}">
                    {% csrf_token %}
                    <input type="hidden" value="new" name="type_of_action">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio1" value="1">
                      <label class="form-check-label" for="inlineRadio1">1</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio2" value="2">
                      <label class="form-check-label" for="inlineRadio2">2</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio3" value="3">
                      <label class="form-check-label" for="inlineRadio3">3</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio4" value="4">
                      <label class="form-check-label" for="inlineRadio4">4</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio5" value="5">
                      <label class="form-check-label" for="inlineRadio5">5</label>
                    </div>
                    <input class="text" name="rated_by" value="{{ request.user }}" hidden>
                    <input class="text" name="book_id" value="{{ book.pk }}" hidden>
                    <button type="submit">rate</button>
                  </form>
                  {% else %}
                  Your rating:
                  <form method="POST" action="{% url 'book_detail' book.id %}">
                    {% csrf_token %}
                    <input type="hidden" value="edit" name="type_of_action">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio1" value="1" {% if current_user_rating.rating == 1 %}checked{% endif %}>
                      <label class="form-check-label" for="inlineRadio1">1</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio2" value="2" {% if current_user_rating.rating == 2 %}checked{% endif %}>
                      <label class="form-check-label" for="inlineRadio2">2</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio3" value="3" {% if current_user_rating.rating == 3 %}checked{% endif %}> 
                      <label class="form-check-label" for="inlineRadio3">3</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio4" value="4" {% if current_user_rating.rating == 4 %}checked{% endif %}>
                      <label class="form-check-label" for="inlineRadio4">4</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ratingOptions" id="inlineRadio5" value="5" {% if current_user_rating.rating == 5 %}checked{% endif %}>
                      <label class="form-check-label" for="inlineRadio5">5</label>
                    </div>
                    <input class="text" name="rated_by" value="{{ request.user }}" hidden>
                    <input class="text" name="book_id" value="{{ book.pk }}" hidden>
                    <button type="submit">update</button>
                  </form>
                  <form method="POST" action="{% url 'book_detail' book.id %}">
                    {% csrf_token %}
                    <input type="hidden" value="delete" name="type_of_action">                    
                    <button type="submit">delete</button>
                  </form>
                    
                  {% endif %}
                {% else %}
                  Please log in to rate.
                {% endif %}
              </div>
            </div>
            
            <div id="menu10" class="tab-pane fade">
              <div class="book-details__section">
                <h4>Book info</h4>
                <p class="mt-3">ISBN: {{ book.isbn }}</p>
                <p class="mt-3">Pages: {{ book.pages }}</p>
                <p class="mt-3">Age from {{ book.age }}</p>
                <p class="mt-3">Best suited for {% if book.gender == "all" %} girls and boys.                  
                  {% else %}
                  {{ book.gender }} {% endif %}</p>
                <p class="mt-3">Author: {{ book.author }}</p>
              </div>
            </div>
        </div>
    </div>
      
 
    </div>
  </main>
{% endblock %}
{% block postloadjs %}
<!-- <script>
$(function () {
  $('input[name="ratingOptions"]').on('change',function(){
    $('form').submit();
    console.log('rating selected');
  });
});
</script> -->
{% endblock %}